!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("alova"),require("react")):"function"==typeof define&&define.amd?define(["exports","alova","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).AlovaSceneHook={},e.alova,e.react)}(this,(function(e,t,n){"use strict";const o=(e=0)=>{let t;return n=>{t&&clearTimeout(t),t=setTimeout(n,e)}},a=[],r={},i=()=>{let e=Math.random().toString(36).substring(2);return r[e]&&(e=i()),e};const s=(c="hooks/usePagination",(e,t)=>{if(!e)throw new Error(`[alova/${c}:Error]${t}`)});var c;let u=0;function l(e,{preloadPreviousPage:n=!0,preloadNextPage:c=!0,total:l=(e=>e.total),data:f=(e=>e.data),initialData:d,append:h=!1,initialPage:p=1,initialPageSize:g=10,debounce:m,watchingStates:v=[],immediate:y=!0},b,P,S,x,C,$,E){const A=u++;let D=!1,M=!1;const j=b(p),w=b(g),F=b([]),T=`pagination-hook-${A}`,k=e=>`${T}-${e}-${x(w)}-${v.map((e=>(e=>{if(!["object","function","symbol"].includes(typeof e))return e;let t=a.find((({ref:t})=>t===e));if(!t){const n=i();t={id:n,ref:e},a.push(t),r[n]=1}return t.id})(x(e)))).join("-")}`,R=e=>f(e)||e,q=t=>{const n=t||x(j),o=x(w),a=e(n,o);return a.config.name=k(n),a};E(v,(()=>{S(j,1),M=!0}));const z=t.useWatcher(q,[...v,j,w],{immediate:y,initialData:d,debounce:m,force:()=>D}),{send:L}=z,_=b(void 0),H=P((()=>{const e=l(x(z.data)),t=x(_);return void 0!==t?t:e}),$(z.data,_)),N=P((()=>{const e=x(H);return void 0!==e?Math.ceil(e/x(w)):void 0}),$(w,H)),O=(e,t=!1)=>{const n=x(N),o=n?e>n:!!t&&R(x(z.data)).length<x(w);return e>0&&!o},W=()=>{const e=x(j)+1;!D&&c&&O(e,!0)&&K(q(e))},B=P((()=>{const e=x(j),t=x(N),n=R(x(z.data)),o=Array.isArray(n)?n.length:0;return t?e>=t:o<x(w)}),$(j,N,z.data,w)),G=()=>{t.setCacheData(k(x(j)),(e=>{const t=R(e)||[];return t.splice(0,t.length,...x(F)),e}))};let I=!1;const J=t.useFetcher({force:()=>D||I}),{fetch:K,abort:Q}=J;z.onSuccess(((e,t)=>{S(_,void 0),(()=>{const e=x(j)-1;!D&&n&&O(e)&&K(q(e))})(),W();const o=x(w),a=R(e);h?(M&&S(F,[]),void 0===t?S(F,[...x(F),...a]):t&&S(F,(e=>(e.splice((t-1)*o,o,...a),e)))):S(F,a),D=!1,M=!1}));const U=t=>{D=!0,h?(s(t<=x(j),"Refresh page can't greater than page"),L(t)):t===x(j)?L():K(e(t,x(w)))};let V,X;const Y=o(),Z=(e=!1)=>{t.invalidateCache({name:new RegExp("^"+T),filter:t=>{if(e)return e;const n=x(j);return![k(n-1),k(n),k(n+1)].includes(t.config.name)}})},ee=o(),te=()=>{ee((()=>{Q(),Z(),I=!0,W(),I=!1}))};return{...z,fetching:J.fetching,onFetchSuccess:J.onSuccess,onFetchError:J.onError,onFetchComplete:J.onComplete,page:j,pageSize:w,data:C(F),pageCount:C(N),total:C(H),isLastPage:C(B),refresh:U,insert:(e,n=0)=>{const o=x(j);let a;S(F,(t=>(a=t.pop(),n>=0?t.splice(n,0,e):t.unshift(e),t)));const r=x(H);"number"==typeof r&&S(_,r+1),G();const i=o+1;t.setCacheData(k(i),(e=>((R(e)||[]).unshift(a),e))),te()},remove:e=>{const n=x(j),o=n+1;t.setCacheData(k(o),(e=>{const t=R(e);return X=(t||[]).shift(),e}));const a=x(B);if(X||a){if(V||(V=[...x(F)]),e>=0){S(F,(t=>(t.splice(e,1),X&&t.push(X),t)));const t=x(H);t&&S(_,Math.max(t-1,0))}}else V&&S(F,V);G(),te(),Y((()=>{X||a||U(n),!h&&a&&x(F).length<=0&&S(j,(e=>e-1)),V=void 0,X=void 0}))},replace:(e,t)=>{s("number"==typeof t&&t<x(F).length,"index must be a number that less than list length"),S(F,(n=>(n.splice(t,1,e),n))),G()},reload:()=>{Z(!0),1===x(j)?L():S(j,1),M=!0}}}const f=n.useState,d=n.useMemo,h=e=>Array.isArray(e)&&"function"==typeof e[1]?e[0]:e,p=h,g=h,m=(...e)=>e.map((e=>g(e))),v=(e,t)=>e[1](t),y=(e,t)=>{const o=n.useRef(!1);n.useLayoutEffect((()=>{o.current?t():o.current=!0}),e)};e.usePagination=(e,t={})=>l(e,t,f,d,v,p,g,m,y),Object.defineProperty(e,"__esModule",{value:!0})}));
