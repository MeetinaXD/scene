!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("alova"),require("vue")):"function"==typeof define&&define.amd?define(["exports","alova","vue"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).AlovaSceneVue={},e.alova,e.vue)}(this,(function(e,t,n){"use strict";const o=(e=0)=>{let t;return n=>{t&&clearTimeout(t),t=setTimeout(n,e)}},a=[],i={},r=()=>{let e=Math.random().toString(36).substring(2);return i[e]&&(e=r()),e};const s=(c="hooks/usePagination",(e,t)=>{if(!e)throw new Error(`[alova/${c}:Error]${t}`)});var c;let u=0;function l(e,{preloadPreviousPage:n=!0,preloadNextPage:c=!0,total:l=(e=>e.total),data:d=(e=>e.data),initialData:f,append:h=!1,initialPage:p=1,initialPageSize:g=10,debounce:m,watchingStates:v=[],immediate:b=!0},y,P,S,x,C,$,w){const D=u++;let E=!1,j=!1;const F=y(p),M=y(g),T=y([]),A=`pagination-hook-${D}`,k=e=>`${A}-${e}-${x(M)}-${v.map((e=>(e=>{if(!["object","function","symbol"].includes(typeof e))return e;let t=a.find((({ref:t})=>t===e));if(!t){const n=r();t={id:n,ref:e},a.push(t),i[n]=1}return t.id})(x(e)))).join("-")}`,q=e=>d(e)||e,z=t=>{const n=t||x(F),o=x(M),a=e(n,o);return a.config.name=k(n),a};w(v,(()=>{S(F,1),j=!0}));const R=t.useWatcher(z,[...v,F,M],{immediate:b,initialData:f,debounce:m,force:()=>E}),{send:_}=R,L=y(void 0),N=P((()=>{const e=l(x(R.data)),t=x(L);return void 0!==t?t:e}),$(R.data,L)),O=P((()=>{const e=x(N);return void 0!==e?Math.ceil(e/x(M)):void 0}),$(M,N)),V=(e,t=!1)=>{const n=x(O),o=n?e>n:!!t&&q(x(R.data)).length<x(M);return e>0&&!o},W=()=>{const e=x(F)+1;!E&&c&&V(e,!0)&&J(z(e))},B=P((()=>{const e=x(F),t=x(O),n=q(x(R.data)),o=Array.isArray(n)?n.length:0;return t?e>=t:o<x(M)}),$(F,O,R.data,M)),G=()=>{t.setCacheData(k(x(F)),(e=>{const t=q(e)||[];return t.splice(0,t.length,...x(T)),e}))};let H=!1;const I=t.useFetcher({force:()=>E||H}),{fetch:J,abort:K}=I;R.onSuccess(((e,t)=>{S(L,void 0),(()=>{const e=x(F)-1;!E&&n&&V(e)&&J(z(e))})(),W();const o=x(M),a=q(e);h?(j&&S(T,[]),void 0===t?S(T,[...x(T),...a]):t&&S(T,(e=>(e.splice((t-1)*o,o,...a),e)))):S(T,a),E=!1,j=!1}));const Q=t=>{E=!0,h?(s(t<=x(F),"Refresh page can't greater than page"),_(t)):t===x(F)?_():J(e(t,x(M)))};let U,X;const Y=o(),Z=(e=!1)=>{t.invalidateCache({name:new RegExp("^"+A),filter:t=>{if(e)return e;const n=x(F);return![k(n-1),k(n),k(n+1)].includes(t.config.name)}})},ee=o(),te=()=>{ee((()=>{K(),Z(),H=!0,W(),H=!1}))};return{...R,fetching:I.fetching,onFetchSuccess:I.onSuccess,onFetchError:I.onError,onFetchComplete:I.onComplete,page:F,pageSize:M,data:C(T),pageCount:C(O),total:C(N),isLastPage:C(B),refresh:Q,insert:(e,n=0)=>{const o=x(F);let a;S(T,(t=>(a=t.pop(),n>=0?t.splice(n,0,e):t.unshift(e),t)));const i=x(N);"number"==typeof i&&S(L,i+1),G();const r=o+1;t.setCacheData(k(r),(e=>((q(e)||[]).unshift(a),e))),te()},remove:e=>{const n=x(F),o=n+1;t.setCacheData(k(o),(e=>{const t=q(e);return X=(t||[]).shift(),e}));const a=x(B);if(X||a){if(U||(U=[...x(T)]),e>=0){S(T,(t=>(t.splice(e,1),X&&t.push(X),t)));const t=x(N);t&&S(L,Math.max(t-1,0))}}else U&&S(T,U);G(),te(),Y((()=>{X||a||Q(n),!h&&a&&x(T).length<=0&&S(F,(e=>e-1)),U=void 0,X=void 0}))},replace:(e,t)=>{s("number"==typeof t&&t<x(T).length,"index must be a number that less than list length"),S(T,(n=>(n.splice(t,1,e),n))),G()},reload:()=>{Z(!0),1===x(F)?_():S(F,1),j=!0}}}const d=n.ref,f=n.computed,h=e=>e.value,p=e=>e,g=(...e)=>e.map((e=>e)),m=(e,t)=>{e.value="function"==typeof t?t(e.value):t},v=(e,t)=>{n.watch(e,t,{flush:"sync",deep:!0})};e.usePagination=(e,t={})=>l(e,t,d,f,m,h,p,g,v),Object.defineProperty(e,"__esModule",{value:!0})}));
