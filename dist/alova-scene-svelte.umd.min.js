!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("alova"),require("svelte/store")):"function"==typeof define&&define.amd?define(["exports","alova","svelte/store"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).AlovaSceneHook={},e.alova,e["svelte/store"])}(this,(function(e,t,n){"use strict";const o=(e=0)=>{let t;return n=>{t&&clearTimeout(t),t=setTimeout(n,e)}},a=[],i={},r=()=>{let e=Math.random().toString(36).substring(2);return i[e]&&(e=r()),e};const s=(c="hooks/usePagination",(e,t)=>{if(!e)throw new Error(`[alova/${c}:Error]${t}`)});var c;let l=0;function u(e,{preloadPreviousPage:n=!0,preloadNextPage:c=!0,total:u=(e=>e.total),data:d=(e=>e.data),initialData:f,append:h=!1,initialPage:p=1,initialPageSize:g=10,debounce:m,watchingStates:v=[],immediate:b=!0},y,P,S,x,C,$,E){const w=l++;let D=!1,j=!1;const F=y(p),M=y(g),T=y([]),k=`pagination-hook-${w}`,A=e=>`${k}-${e}-${x(M)}-${v.map((e=>(e=>{if(!["object","function","symbol"].includes(typeof e))return e;let t=a.find((({ref:t})=>t===e));if(!t){const n=r();t={id:n,ref:e},a.push(t),i[n]=1}return t.id})(x(e)))).join("-")}`,q=e=>d(e)||e,z=t=>{const n=t||x(F),o=x(M),a=e(n,o);return a.config.name=A(n),a};E(v,(()=>{S(F,1),j=!0}));const R=t.useWatcher(z,[...v,F,M],{immediate:b,initialData:f,debounce:m,force:()=>D}),{send:_}=R,H=y(void 0),L=P((()=>{const e=u(x(R.data)),t=x(H);return void 0!==t?t:e}),$(R.data,H)),N=P((()=>{const e=x(L);return void 0!==e?Math.ceil(e/x(M)):void 0}),$(M,L)),O=(e,t=!1)=>{const n=x(N),o=n?e>n:!!t&&q(x(R.data)).length<x(M);return e>0&&!o},W=()=>{const e=x(F)+1;!D&&c&&O(e,!0)&&K(z(e))},B=P((()=>{const e=x(F),t=x(N),n=q(x(R.data)),o=Array.isArray(n)?n.length:0;return t?e>=t:o<x(M)}),$(F,N,R.data,M)),G=()=>{t.setCacheData(A(x(F)),(e=>{const t=q(e)||[];return t.splice(0,t.length,...x(T)),e}))};let I=!1;const J=t.useFetcher({force:()=>D||I}),{fetch:K,abort:Q}=J;R.onSuccess(((e,t)=>{S(H,void 0),(()=>{const e=x(F)-1;!D&&n&&O(e)&&K(z(e))})(),W();const o=x(M),a=q(e);h?(j&&S(T,[]),void 0===t?S(T,[...x(T),...a]):t&&S(T,(e=>(e.splice((t-1)*o,o,...a),e)))):S(T,a),D=!1,j=!1}));const U=t=>{D=!0,h?(s(t<=x(F),"Refresh page can't greater than page"),_(t)):t===x(F)?_():K(e(t,x(M)))};let V,X;const Y=o(),Z=(e=!1)=>{t.invalidateCache({name:new RegExp("^"+k),filter:t=>{if(e)return e;const n=x(F);return![A(n-1),A(n),A(n+1)].includes(t.config.name)}})},ee=o(),te=()=>{ee((()=>{Q(),Z(),I=!0,W(),I=!1}))};return{...R,fetching:J.fetching,onFetchSuccess:J.onSuccess,onFetchError:J.onError,onFetchComplete:J.onComplete,page:F,pageSize:M,data:C(T),pageCount:C(N),total:C(L),isLastPage:C(B),refresh:U,insert:(e,n=0)=>{const o=x(F);let a;S(T,(t=>(a=t.pop(),n>=0?t.splice(n,0,e):t.unshift(e),t)));const i=x(L);"number"==typeof i&&S(H,i+1),G();const r=o+1;t.setCacheData(A(r),(e=>((q(e)||[]).unshift(a),e))),te()},remove:e=>{const n=x(F),o=n+1;t.setCacheData(A(o),(e=>{const t=q(e);return X=(t||[]).shift(),e}));const a=x(B);if(X||a){if(V||(V=[...x(T)]),e>=0){S(T,(t=>(t.splice(e,1),X&&t.push(X),t)));const t=x(L);t&&S(H,Math.max(t-1,0))}}else V&&S(T,V);G(),te(),Y((()=>{X||a||U(n),!h&&a&&x(T).length<=0&&S(F,(e=>e-1)),V=void 0,X=void 0}))},replace:(e,t)=>{s("number"==typeof t&&t<x(T).length,"index must be a number that less than list length"),S(T,(n=>(n.splice(t,1,e),n))),G()},reload:()=>{Z(!0),1===x(F)?_():S(F,1),j=!0}}}const d=e=>n.writable(e),f=(e,t)=>n.derived(t,e),h=e=>{let t;return e.subscribe((e=>t=e))(),t},p=e=>e,g=(...e)=>e.map((e=>e)),m=(e,t)=>{"function"==typeof t?e.update(t):e.set(t)},v=(e,t)=>{let n=!1,a=!0;const i=o(),r=()=>{n||a||(t(),n=!0),i((()=>{n=a=!1}))};e.forEach((e=>{e.subscribe(r)}))};e.usePagination=(e,t={})=>u(e,t,d,f,m,h,p,g,v),Object.defineProperty(e,"__esModule",{value:!0})}));
